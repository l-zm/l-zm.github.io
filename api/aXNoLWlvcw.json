{"title":"使用 iSH App在iPhone上优选 Cloudflare IP","date":"2024-01-03T00:00:00.000Z","date_formatted":{"ll":"2024年1月3日","L":"2024/01/03","MM-DD":"01-03"},"thumbnail":"https://i.l-zm.com/i/240103ishapp.png","link":"ish-ios","tags":["App"],"categories":["App"],"updated":"2024-01-02T16:00:00.000Z","content":"<h3 id=\"ish-官网-ish.app\">iSH 官网 ish.app<a title=\"#ish-官网-ish.app\" href=\"#ish-官网-ish.app\"></a></h3>\n<p>iSH 是一个项目，用于使用用户模式 x86 模拟器在 iOS 设备上本地运行 Linux shell 环境</p>\n<p>该应用程序永远完全免费</p>\n<h3 id=\"下载\">下载<a title=\"#下载\" href=\"#下载\"></a></h3>\n<p>AppStore中搜索ish下载安装</p>\n<h3 id=\"步骤\">步骤<a title=\"#步骤\" href=\"#步骤\"></a></h3>\n<h4 id=\"1.-安装依赖\">1. 安装依赖<a title=\"#1.-安装依赖\" href=\"#1.-安装依赖\"></a></h4>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">apk update &amp;&amp; apk add -f wget curl bash</span><br></pre></td></tr></table></figure>\n<ul>\n<li>如果这里更新安装失败, 可以更换下代理节点</li>\n</ul>\n<h4 id=\"2.-下载优选代码.sh脚本-(git项目:-better-cloudflare-ip)\">2. 下载优选代码.sh脚本 (Git项目: better-cloudflare-ip)<a title=\"#2.-下载优选代码.sh脚本-(git项目:-better-cloudflare-ip)\" href=\"#2.-下载优选代码.sh脚本-(git项目:-better-cloudflare-ip)\"></a></h4>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">wget -N https://raw.githubusercontent.com/badafans/better-cloudflare-ip/master/shell/cf.sh</span><br></pre></td></tr></table></figure>\n<h4 id=\"3.-开始优选\">3. 开始优选<a title=\"#3.-开始优选\" href=\"#3.-开始优选\"></a></h4>\n<p><code>./cf.sh</code></p>\n<ul>\n<li>开始优选的时候, 切记关闭代理</li>\n<li>如果这里有权限问题, 执行: <code>chmod u+x cf.sh</code></li>\n</ul>\n<h3 id=\"最后\">最后<a title=\"#最后\" href=\"#最后\"></a></h3>\n<p>后续优选IP, 只需输入 <code>./cf.sh</code> 回车即可</p>\n<hr>\n<blockquote>\n<p>Github 地址: <code>https://github.com/badafans/better-cloudflare-ip</code></p>\n</blockquote>\n<blockquote>\n<p>脚本详情</p>\n</blockquote>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br><span class=\"line\">171</span><br><span class=\"line\">172</span><br><span class=\"line\">173</span><br><span class=\"line\">174</span><br><span class=\"line\">175</span><br><span class=\"line\">176</span><br><span class=\"line\">177</span><br><span class=\"line\">178</span><br><span class=\"line\">179</span><br><span class=\"line\">180</span><br><span class=\"line\">181</span><br><span class=\"line\">182</span><br><span class=\"line\">183</span><br><span class=\"line\">184</span><br><span class=\"line\">185</span><br><span class=\"line\">186</span><br><span class=\"line\">187</span><br><span class=\"line\">188</span><br><span class=\"line\">189</span><br><span class=\"line\">190</span><br><span class=\"line\">191</span><br><span class=\"line\">192</span><br><span class=\"line\">193</span><br><span class=\"line\">194</span><br><span class=\"line\">195</span><br><span class=\"line\">196</span><br><span class=\"line\">197</span><br><span class=\"line\">198</span><br><span class=\"line\">199</span><br><span class=\"line\">200</span><br><span class=\"line\">201</span><br><span class=\"line\">202</span><br><span class=\"line\">203</span><br><span class=\"line\">204</span><br><span class=\"line\">205</span><br><span class=\"line\">206</span><br><span class=\"line\">207</span><br><span class=\"line\">208</span><br><span class=\"line\">209</span><br><span class=\"line\">210</span><br><span class=\"line\">211</span><br><span class=\"line\">212</span><br><span class=\"line\">213</span><br><span class=\"line\">214</span><br><span class=\"line\">215</span><br><span class=\"line\">216</span><br><span class=\"line\">217</span><br><span class=\"line\">218</span><br><span class=\"line\">219</span><br><span class=\"line\">220</span><br><span class=\"line\">221</span><br><span class=\"line\">222</span><br><span class=\"line\">223</span><br><span class=\"line\">224</span><br><span class=\"line\">225</span><br><span class=\"line\">226</span><br><span class=\"line\">227</span><br><span class=\"line\">228</span><br><span class=\"line\">229</span><br><span class=\"line\">230</span><br><span class=\"line\">231</span><br><span class=\"line\">232</span><br><span class=\"line\">233</span><br><span class=\"line\">234</span><br><span class=\"line\">235</span><br><span class=\"line\">236</span><br><span class=\"line\">237</span><br><span class=\"line\">238</span><br><span class=\"line\">239</span><br><span class=\"line\">240</span><br><span class=\"line\">241</span><br><span class=\"line\">242</span><br><span class=\"line\">243</span><br><span class=\"line\">244</span><br><span class=\"line\">245</span><br><span class=\"line\">246</span><br><span class=\"line\">247</span><br><span class=\"line\">248</span><br><span class=\"line\">249</span><br><span class=\"line\">250</span><br><span class=\"line\">251</span><br><span class=\"line\">252</span><br><span class=\"line\">253</span><br><span class=\"line\">254</span><br><span class=\"line\">255</span><br><span class=\"line\">256</span><br><span class=\"line\">257</span><br><span class=\"line\">258</span><br><span class=\"line\">259</span><br><span class=\"line\">260</span><br><span class=\"line\">261</span><br><span class=\"line\">262</span><br><span class=\"line\">263</span><br><span class=\"line\">264</span><br><span class=\"line\">265</span><br><span class=\"line\">266</span><br><span class=\"line\">267</span><br><span class=\"line\">268</span><br><span class=\"line\">269</span><br><span class=\"line\">270</span><br><span class=\"line\">271</span><br><span class=\"line\">272</span><br><span class=\"line\">273</span><br><span class=\"line\">274</span><br><span class=\"line\">275</span><br><span class=\"line\">276</span><br><span class=\"line\">277</span><br><span class=\"line\">278</span><br><span class=\"line\">279</span><br><span class=\"line\">280</span><br><span class=\"line\">281</span><br><span class=\"line\">282</span><br><span class=\"line\">283</span><br><span class=\"line\">284</span><br><span class=\"line\">285</span><br><span class=\"line\">286</span><br><span class=\"line\">287</span><br><span class=\"line\">288</span><br><span class=\"line\">289</span><br><span class=\"line\">290</span><br><span class=\"line\">291</span><br><span class=\"line\">292</span><br><span class=\"line\">293</span><br><span class=\"line\">294</span><br><span class=\"line\">295</span><br><span class=\"line\">296</span><br><span class=\"line\">297</span><br><span class=\"line\">298</span><br><span class=\"line\">299</span><br><span class=\"line\">300</span><br><span class=\"line\">301</span><br><span class=\"line\">302</span><br><span class=\"line\">303</span><br><span class=\"line\">304</span><br><span class=\"line\">305</span><br><span class=\"line\">306</span><br><span class=\"line\">307</span><br><span class=\"line\">308</span><br><span class=\"line\">309</span><br><span class=\"line\">310</span><br><span class=\"line\">311</span><br><span class=\"line\">312</span><br><span class=\"line\">313</span><br><span class=\"line\">314</span><br><span class=\"line\">315</span><br><span class=\"line\">316</span><br><span class=\"line\">317</span><br><span class=\"line\">318</span><br><span class=\"line\">319</span><br><span class=\"line\">320</span><br><span class=\"line\">321</span><br><span class=\"line\">322</span><br><span class=\"line\">323</span><br><span class=\"line\">324</span><br><span class=\"line\">325</span><br><span class=\"line\">326</span><br><span class=\"line\">327</span><br><span class=\"line\">328</span><br><span class=\"line\">329</span><br><span class=\"line\">330</span><br><span class=\"line\">331</span><br><span class=\"line\">332</span><br><span class=\"line\">333</span><br><span class=\"line\">334</span><br><span class=\"line\">335</span><br><span class=\"line\">336</span><br><span class=\"line\">337</span><br><span class=\"line\">338</span><br><span class=\"line\">339</span><br><span class=\"line\">340</span><br><span class=\"line\">341</span><br><span class=\"line\">342</span><br><span class=\"line\">343</span><br><span class=\"line\">344</span><br><span class=\"line\">345</span><br><span class=\"line\">346</span><br><span class=\"line\">347</span><br><span class=\"line\">348</span><br><span class=\"line\">349</span><br><span class=\"line\">350</span><br><span class=\"line\">351</span><br><span class=\"line\">352</span><br><span class=\"line\">353</span><br><span class=\"line\">354</span><br><span class=\"line\">355</span><br><span class=\"line\">356</span><br><span class=\"line\">357</span><br><span class=\"line\">358</span><br><span class=\"line\">359</span><br><span class=\"line\">360</span><br><span class=\"line\">361</span><br><span class=\"line\">362</span><br><span class=\"line\">363</span><br><span class=\"line\">364</span><br><span class=\"line\">365</span><br><span class=\"line\">366</span><br><span class=\"line\">367</span><br><span class=\"line\">368</span><br><span class=\"line\">369</span><br><span class=\"line\">370</span><br><span class=\"line\">371</span><br><span class=\"line\">372</span><br><span class=\"line\">373</span><br><span class=\"line\">374</span><br><span class=\"line\">375</span><br><span class=\"line\">376</span><br><span class=\"line\">377</span><br><span class=\"line\">378</span><br><span class=\"line\">379</span><br><span class=\"line\">380</span><br><span class=\"line\">381</span><br><span class=\"line\">382</span><br><span class=\"line\">383</span><br><span class=\"line\">384</span><br><span class=\"line\">385</span><br><span class=\"line\">386</span><br><span class=\"line\">387</span><br><span class=\"line\">388</span><br><span class=\"line\">389</span><br><span class=\"line\">390</span><br><span class=\"line\">391</span><br><span class=\"line\">392</span><br><span class=\"line\">393</span><br><span class=\"line\">394</span><br><span class=\"line\">395</span><br><span class=\"line\">396</span><br><span class=\"line\">397</span><br><span class=\"line\">398</span><br><span class=\"line\">399</span><br><span class=\"line\">400</span><br><span class=\"line\">401</span><br><span class=\"line\">402</span><br><span class=\"line\">403</span><br><span class=\"line\">404</span><br><span class=\"line\">405</span><br><span class=\"line\">406</span><br><span class=\"line\">407</span><br><span class=\"line\">408</span><br><span class=\"line\">409</span><br><span class=\"line\">410</span><br><span class=\"line\">411</span><br><span class=\"line\">412</span><br><span class=\"line\">413</span><br><span class=\"line\">414</span><br><span class=\"line\">415</span><br><span class=\"line\">416</span><br><span class=\"line\">417</span><br><span class=\"line\">418</span><br><span class=\"line\">419</span><br><span class=\"line\">420</span><br><span class=\"line\">421</span><br><span class=\"line\">422</span><br><span class=\"line\">423</span><br><span class=\"line\">424</span><br><span class=\"line\">425</span><br><span class=\"line\">426</span><br><span class=\"line\">427</span><br><span class=\"line\">428</span><br><span class=\"line\">429</span><br><span class=\"line\">430</span><br><span class=\"line\">431</span><br><span class=\"line\">432</span><br><span class=\"line\">433</span><br><span class=\"line\">434</span><br><span class=\"line\">435</span><br><span class=\"line\">436</span><br><span class=\"line\">437</span><br><span class=\"line\">438</span><br><span class=\"line\">439</span><br><span class=\"line\">440</span><br><span class=\"line\">441</span><br><span class=\"line\">442</span><br><span class=\"line\">443</span><br><span class=\"line\">444</span><br><span class=\"line\">445</span><br><span class=\"line\">446</span><br><span class=\"line\">447</span><br><span class=\"line\">448</span><br><span class=\"line\">449</span><br><span class=\"line\">450</span><br><span class=\"line\">451</span><br><span class=\"line\">452</span><br><span class=\"line\">453</span><br><span class=\"line\">454</span><br><span class=\"line\">455</span><br><span class=\"line\">456</span><br><span class=\"line\">457</span><br><span class=\"line\">458</span><br><span class=\"line\">459</span><br><span class=\"line\">460</span><br><span class=\"line\">461</span><br><span class=\"line\">462</span><br><span class=\"line\">463</span><br><span class=\"line\">464</span><br><span class=\"line\">465</span><br><span class=\"line\">466</span><br><span class=\"line\">467</span><br><span class=\"line\">468</span><br><span class=\"line\">469</span><br><span class=\"line\">470</span><br><span class=\"line\">471</span><br><span class=\"line\">472</span><br><span class=\"line\">473</span><br><span class=\"line\">474</span><br><span class=\"line\">475</span><br><span class=\"line\">476</span><br><span class=\"line\">477</span><br><span class=\"line\">478</span><br><span class=\"line\">479</span><br><span class=\"line\">480</span><br><span class=\"line\">481</span><br><span class=\"line\">482</span><br><span class=\"line\">483</span><br><span class=\"line\">484</span><br><span class=\"line\">485</span><br><span class=\"line\">486</span><br><span class=\"line\">487</span><br><span class=\"line\">488</span><br><span class=\"line\">489</span><br><span class=\"line\">490</span><br><span class=\"line\">491</span><br><span class=\"line\">492</span><br><span class=\"line\">493</span><br><span class=\"line\">494</span><br><span class=\"line\">495</span><br><span class=\"line\">496</span><br><span class=\"line\">497</span><br><span class=\"line\">498</span><br><span class=\"line\">499</span><br><span class=\"line\">500</span><br><span class=\"line\">501</span><br><span class=\"line\">502</span><br><span class=\"line\">503</span><br><span class=\"line\">504</span><br><span class=\"line\">505</span><br><span class=\"line\">506</span><br><span class=\"line\">507</span><br><span class=\"line\">508</span><br><span class=\"line\">509</span><br><span class=\"line\">510</span><br><span class=\"line\">511</span><br><span class=\"line\">512</span><br><span class=\"line\">513</span><br><span class=\"line\">514</span><br><span class=\"line\">515</span><br><span class=\"line\">516</span><br><span class=\"line\">517</span><br><span class=\"line\">518</span><br><span class=\"line\">519</span><br><span class=\"line\">520</span><br><span class=\"line\">521</span><br><span class=\"line\">522</span><br><span class=\"line\">523</span><br><span class=\"line\">524</span><br><span class=\"line\">525</span><br><span class=\"line\">526</span><br><span class=\"line\">527</span><br><span class=\"line\">528</span><br><span class=\"line\">529</span><br><span class=\"line\">530</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#!/bin/bash</span></span><br><span class=\"line\"><span class=\"comment\"># better-cloudflare-ip</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"function\"><span class=\"title\">bettercloudflareip</span></span>()&#123;</span><br><span class=\"line\"><span class=\"built_in\">read</span> -p <span class=\"string\">&quot;请设置期望的带宽大小(默认最小1,单位 Mbps):&quot;</span> bandwidth</span><br><span class=\"line\"><span class=\"built_in\">read</span> -p <span class=\"string\">&quot;请设置RTT测试进程数(默认10,最大50):&quot;</span> tasknum</span><br><span class=\"line\"><span class=\"keyword\">if</span> [ -z <span class=\"string\">&quot;<span class=\"variable\">$bandwidth</span>&quot;</span> ]</span><br><span class=\"line\"><span class=\"keyword\">then</span></span><br><span class=\"line\">\tbandwidth=1</span><br><span class=\"line\"><span class=\"keyword\">fi</span></span><br><span class=\"line\"><span class=\"keyword\">if</span> [ <span class=\"variable\">$bandwidth</span> -eq 0 ]</span><br><span class=\"line\"><span class=\"keyword\">then</span></span><br><span class=\"line\">\tbandwidth=1</span><br><span class=\"line\"><span class=\"keyword\">fi</span></span><br><span class=\"line\"><span class=\"keyword\">if</span> [ -z <span class=\"string\">&quot;<span class=\"variable\">$tasknum</span>&quot;</span> ]</span><br><span class=\"line\"><span class=\"keyword\">then</span></span><br><span class=\"line\">\ttasknum=10</span><br><span class=\"line\"><span class=\"keyword\">fi</span></span><br><span class=\"line\"><span class=\"keyword\">if</span> [ <span class=\"variable\">$tasknum</span> -eq 0 ]</span><br><span class=\"line\"><span class=\"keyword\">then</span></span><br><span class=\"line\">\t<span class=\"built_in\">echo</span> <span class=\"string\">&quot;进程数不能为0,自动设置为默认值&quot;</span></span><br><span class=\"line\">\ttasknum=10</span><br><span class=\"line\"><span class=\"keyword\">fi</span></span><br><span class=\"line\"><span class=\"keyword\">if</span> [ <span class=\"variable\">$tasknum</span> -gt 50 ]</span><br><span class=\"line\"><span class=\"keyword\">then</span></span><br><span class=\"line\">\t<span class=\"built_in\">echo</span> <span class=\"string\">&quot;超过最大进程限制,自动设置为最大值&quot;</span></span><br><span class=\"line\">\ttasknum=50</span><br><span class=\"line\"><span class=\"keyword\">fi</span></span><br><span class=\"line\">speed=$[<span class=\"variable\">$bandwidth</span>*128*1024]</span><br><span class=\"line\">starttime=$(<span class=\"built_in\">date</span> +%s)</span><br><span class=\"line\">cloudflaretest</span><br><span class=\"line\">realbandwidth=$[<span class=\"variable\">$max</span>/128]</span><br><span class=\"line\">endtime=$(<span class=\"built_in\">date</span> +%s)</span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">&quot;从服务器获取详细信息&quot;</span></span><br><span class=\"line\"><span class=\"built_in\">unset</span> temp</span><br><span class=\"line\"><span class=\"keyword\">if</span> [ <span class=\"string\">&quot;<span class=\"variable\">$ips</span>&quot;</span> == <span class=\"string\">&quot;ipv4&quot;</span> ]</span><br><span class=\"line\"><span class=\"keyword\">then</span></span><br><span class=\"line\">\t<span class=\"keyword\">if</span> [ <span class=\"variable\">$tls</span> == 1 ]</span><br><span class=\"line\">\t<span class=\"keyword\">then</span></span><br><span class=\"line\">\t\ttemp=($(curl --resolve <span class=\"variable\">$domain</span>:443:<span class=\"variable\">$anycast</span> --retry 1 -s https://<span class=\"variable\">$domain</span>/cdn-cgi/trace --connect-timeout 2 --max-time 3))</span><br><span class=\"line\">\t<span class=\"keyword\">else</span></span><br><span class=\"line\">\t\ttemp=($(curl -x <span class=\"variable\">$anycast</span>:80 --retry 1 -s http://<span class=\"variable\">$domain</span>/cdn-cgi/trace --connect-timeout 2 --max-time 3))</span><br><span class=\"line\">\t<span class=\"keyword\">fi</span></span><br><span class=\"line\"><span class=\"keyword\">else</span></span><br><span class=\"line\">\t<span class=\"keyword\">if</span> [ <span class=\"variable\">$tls</span> == 1 ]</span><br><span class=\"line\">\t<span class=\"keyword\">then</span></span><br><span class=\"line\">\t\ttemp=($(curl --resolve <span class=\"variable\">$domain</span>:443:<span class=\"variable\">$anycast</span> --retry 1 -s https://<span class=\"variable\">$domain</span>/cdn-cgi/trace --connect-timeout 2 --max-time 3))</span><br><span class=\"line\">\t<span class=\"keyword\">else</span></span><br><span class=\"line\">\t\ttemp=($(curl -x [<span class=\"variable\">$anycast</span>]:80 --retry 1 -s http://<span class=\"variable\">$domain</span>/cdn-cgi/trace --connect-timeout 2 --max-time 3))</span><br><span class=\"line\">\t<span class=\"keyword\">fi</span></span><br><span class=\"line\"><span class=\"keyword\">fi</span></span><br><span class=\"line\"><span class=\"keyword\">if</span> [ $(<span class=\"built_in\">echo</span> <span class=\"variable\">$&#123;temp[@]&#125;</span> | sed -e <span class=\"string\">&#x27;s/ /\\n/g&#x27;</span> | grep colo= | <span class=\"built_in\">wc</span> -l) == 0 ]</span><br><span class=\"line\"><span class=\"keyword\">then</span></span><br><span class=\"line\">\tpublicip=获取超时</span><br><span class=\"line\">\tcolo=获取超时</span><br><span class=\"line\"><span class=\"keyword\">else</span></span><br><span class=\"line\">\tpublicip=$(<span class=\"built_in\">echo</span> <span class=\"variable\">$&#123;temp[@]&#125;</span> | sed -e <span class=\"string\">&#x27;s/ /\\n/g&#x27;</span> | grep ip= | <span class=\"built_in\">cut</span> -f 2- -d<span class=\"string\">&#x27;=&#x27;</span>)</span><br><span class=\"line\">\tcolo=$(grep -w <span class=\"string\">&quot;(<span class=\"subst\">$(echo $&#123;temp[@]&#125; | sed -e &#x27;s/ /\\n/g&#x27; | grep colo= | cut -f 2- -d&#x27;=&#x27;)</span>)&quot;</span> colo.txt | awk -F<span class=\"string\">&quot;-&quot;</span> <span class=\"string\">&#x27;&#123;print $1&#125;&#x27;</span>)</span><br><span class=\"line\"><span class=\"keyword\">fi</span></span><br><span class=\"line\">clear</span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">&quot;优选IP <span class=\"variable\">$anycast</span>&quot;</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">&quot;公网IP <span class=\"variable\">$publicip</span>&quot;</span></span><br><span class=\"line\"><span class=\"keyword\">if</span> [ <span class=\"variable\">$tls</span> == 1 ]</span><br><span class=\"line\"><span class=\"keyword\">then</span></span><br><span class=\"line\">\t<span class=\"built_in\">echo</span> <span class=\"string\">&quot;支持端口 443 2053 2083 2087 2096 8443&quot;</span></span><br><span class=\"line\"><span class=\"keyword\">else</span></span><br><span class=\"line\">\t<span class=\"built_in\">echo</span> <span class=\"string\">&quot;支持端口 80 8080 8880 2052 2082 2086 2095&quot;</span></span><br><span class=\"line\"><span class=\"keyword\">fi</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">&quot;设置带宽 <span class=\"variable\">$bandwidth</span> Mbps&quot;</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">&quot;实测带宽 <span class=\"variable\">$realbandwidth</span> Mbps&quot;</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">&quot;峰值速度 <span class=\"variable\">$max</span> kB/s&quot;</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">&quot;往返延迟 <span class=\"variable\">$avgms</span> 毫秒&quot;</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">&quot;数据中心 <span class=\"variable\">$colo</span>&quot;</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">&quot;总计用时 $[<span class=\"variable\">$endtime</span>-<span class=\"variable\">$starttime</span>] 秒&quot;</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"function\"><span class=\"title\">rtthttps</span></span>()&#123;</span><br><span class=\"line\">avgms=0</span><br><span class=\"line\">n=1</span><br><span class=\"line\"><span class=\"keyword\">for</span> ip <span class=\"keyword\">in</span> `<span class=\"built_in\">cat</span> rtt/<span class=\"variable\">$1</span>.txt`</span><br><span class=\"line\"><span class=\"keyword\">do</span></span><br><span class=\"line\">\t<span class=\"keyword\">while</span> <span class=\"literal\">true</span></span><br><span class=\"line\">\t<span class=\"keyword\">do</span></span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> [ <span class=\"variable\">$n</span> -le 3 ]</span><br><span class=\"line\">\t\t<span class=\"keyword\">then</span></span><br><span class=\"line\">\t\t\trsp=$(curl --resolve <span class=\"variable\">$domain</span>:443:<span class=\"variable\">$ip</span> https://<span class=\"variable\">$domain</span>/cdn-cgi/trace -o /dev/null -s --connect-timeout 1 --max-time 3 -w %&#123;time_connect&#125;_%&#123;http_code&#125;)</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">if</span> [ $(<span class=\"built_in\">echo</span> <span class=\"variable\">$rsp</span> | awk -F_ <span class=\"string\">&#x27;&#123;print $2&#125;&#x27;</span>) != 200 ]</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">then</span></span><br><span class=\"line\">\t\t\t\tavgms=0</span><br><span class=\"line\">\t\t\t\tn=1</span><br><span class=\"line\">\t\t\t\t<span class=\"built_in\">break</span></span><br><span class=\"line\">\t\t\t<span class=\"keyword\">else</span></span><br><span class=\"line\">\t\t\t\tavgms=$[$(<span class=\"built_in\">echo</span> <span class=\"variable\">$rsp</span> | awk -F_ <span class=\"string\">&#x27;&#123;printf (&quot;%d\\n&quot;,$1*1000000)&#125;&#x27;</span>)+<span class=\"variable\">$avgms</span>]</span><br><span class=\"line\">\t\t\t\tn=$[<span class=\"variable\">$n</span>+1]</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">fi</span></span><br><span class=\"line\">\t\t<span class=\"keyword\">else</span></span><br><span class=\"line\">\t\t\tavgms=$[<span class=\"variable\">$avgms</span>/3000]</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">if</span> [ <span class=\"variable\">$avgms</span> -lt 10 ]</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">then</span></span><br><span class=\"line\">\t\t\t\t<span class=\"built_in\">echo</span> 00<span class=\"variable\">$avgms</span> <span class=\"variable\">$ip</span> &gt;&gt; rtt/<span class=\"variable\">$1</span>.<span class=\"built_in\">log</span></span><br><span class=\"line\">\t\t\t<span class=\"keyword\">elif</span> [ <span class=\"variable\">$avgms</span> -ge 10 ] &amp;&amp; [ <span class=\"variable\">$avgms</span> -lt 100 ]</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">then</span></span><br><span class=\"line\">\t\t\t\t<span class=\"built_in\">echo</span> 0<span class=\"variable\">$avgms</span> <span class=\"variable\">$ip</span> &gt;&gt; rtt/<span class=\"variable\">$1</span>.<span class=\"built_in\">log</span></span><br><span class=\"line\">\t\t\t<span class=\"keyword\">else</span></span><br><span class=\"line\">\t\t\t\t<span class=\"built_in\">echo</span> <span class=\"variable\">$avgms</span> <span class=\"variable\">$ip</span> &gt;&gt; rtt/<span class=\"variable\">$1</span>.<span class=\"built_in\">log</span></span><br><span class=\"line\">\t\t\t<span class=\"keyword\">fi</span></span><br><span class=\"line\">\t\t\tavgms=0</span><br><span class=\"line\">\t\t\tn=1</span><br><span class=\"line\">\t\t\t<span class=\"built_in\">break</span></span><br><span class=\"line\">\t\t<span class=\"keyword\">fi</span></span><br><span class=\"line\">\t<span class=\"keyword\">done</span></span><br><span class=\"line\"><span class=\"keyword\">done</span></span><br><span class=\"line\"><span class=\"built_in\">rm</span> -rf rtt/<span class=\"variable\">$1</span>.txt</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"function\"><span class=\"title\">rtthttp</span></span>()&#123;</span><br><span class=\"line\">avgms=0</span><br><span class=\"line\">n=1</span><br><span class=\"line\"><span class=\"keyword\">for</span> ip <span class=\"keyword\">in</span> `<span class=\"built_in\">cat</span> rtt/<span class=\"variable\">$1</span>.txt`</span><br><span class=\"line\"><span class=\"keyword\">do</span></span><br><span class=\"line\">\t<span class=\"keyword\">while</span> <span class=\"literal\">true</span></span><br><span class=\"line\">\t<span class=\"keyword\">do</span></span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> [ <span class=\"variable\">$n</span> -le 3 ]</span><br><span class=\"line\">\t\t<span class=\"keyword\">then</span></span><br><span class=\"line\">\t\t\t<span class=\"keyword\">if</span> [ $(<span class=\"built_in\">echo</span> <span class=\"variable\">$ip</span> | grep : | <span class=\"built_in\">wc</span> -l) == 0 ]</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">then</span></span><br><span class=\"line\">\t\t\t\trsp=$(curl -x <span class=\"variable\">$ip</span>:80 http://<span class=\"variable\">$domain</span>/cdn-cgi/trace -o /dev/null -s --connect-timeout 1 --max-time 3 -w %&#123;time_connect&#125;_%&#123;http_code&#125;)</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">else</span></span><br><span class=\"line\">\t\t\t\trsp=$(curl -x [<span class=\"variable\">$ip</span>]:80 http://<span class=\"variable\">$domain</span>/cdn-cgi/trace -o /dev/null -s --connect-timeout 1 --max-time 3 -w %&#123;time_connect&#125;_%&#123;http_code&#125;)</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">fi</span></span><br><span class=\"line\">\t\t\t<span class=\"keyword\">if</span> [ $(<span class=\"built_in\">echo</span> <span class=\"variable\">$rsp</span> | awk -F_ <span class=\"string\">&#x27;&#123;print $2&#125;&#x27;</span>) != 200 ]</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">then</span></span><br><span class=\"line\">\t\t\t\tavgms=0</span><br><span class=\"line\">\t\t\t\tn=1</span><br><span class=\"line\">\t\t\t\t<span class=\"built_in\">break</span></span><br><span class=\"line\">\t\t\t<span class=\"keyword\">else</span></span><br><span class=\"line\">\t\t\t\tavgms=$[$(<span class=\"built_in\">echo</span> <span class=\"variable\">$rsp</span> | awk -F_ <span class=\"string\">&#x27;&#123;printf (&quot;%d\\n&quot;,$1*1000000)&#125;&#x27;</span>)+<span class=\"variable\">$avgms</span>]</span><br><span class=\"line\">\t\t\t\tn=$[<span class=\"variable\">$n</span>+1]</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">fi</span></span><br><span class=\"line\">\t\t<span class=\"keyword\">else</span></span><br><span class=\"line\">\t\t\tavgms=$[<span class=\"variable\">$avgms</span>/3000]</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">if</span> [ <span class=\"variable\">$avgms</span> -lt 10 ]</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">then</span></span><br><span class=\"line\">\t\t\t\t<span class=\"built_in\">echo</span> 00<span class=\"variable\">$avgms</span> <span class=\"variable\">$ip</span> &gt;&gt; rtt/<span class=\"variable\">$1</span>.<span class=\"built_in\">log</span></span><br><span class=\"line\">\t\t\t<span class=\"keyword\">elif</span> [ <span class=\"variable\">$avgms</span> -ge 10 ] &amp;&amp; [ <span class=\"variable\">$avgms</span> -lt 100 ]</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">then</span></span><br><span class=\"line\">\t\t\t\t<span class=\"built_in\">echo</span> 0<span class=\"variable\">$avgms</span> <span class=\"variable\">$ip</span> &gt;&gt; rtt/<span class=\"variable\">$1</span>.<span class=\"built_in\">log</span></span><br><span class=\"line\">\t\t\t<span class=\"keyword\">else</span></span><br><span class=\"line\">\t\t\t\t<span class=\"built_in\">echo</span> <span class=\"variable\">$avgms</span> <span class=\"variable\">$ip</span> &gt;&gt; rtt/<span class=\"variable\">$1</span>.<span class=\"built_in\">log</span></span><br><span class=\"line\">\t\t\t<span class=\"keyword\">fi</span></span><br><span class=\"line\">\t\t\tavgms=0</span><br><span class=\"line\">\t\t\tn=1</span><br><span class=\"line\">\t\t\t<span class=\"built_in\">break</span></span><br><span class=\"line\">\t\t<span class=\"keyword\">fi</span></span><br><span class=\"line\">\t<span class=\"keyword\">done</span></span><br><span class=\"line\"><span class=\"keyword\">done</span></span><br><span class=\"line\"><span class=\"built_in\">rm</span> -rf rtt/<span class=\"variable\">$1</span>.txt</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"function\"><span class=\"title\">speedtesthttps</span></span>()&#123;</span><br><span class=\"line\"><span class=\"built_in\">rm</span> -rf log.txt speed.txt</span><br><span class=\"line\">curl --resolve <span class=\"variable\">$domain</span>:443:<span class=\"variable\">$1</span> https://<span class=\"variable\">$domain</span>/<span class=\"variable\">$file</span> -o /dev/null --connect-timeout 1 --max-time 10 &gt; log.txt 2&gt;&amp;1</span><br><span class=\"line\"><span class=\"built_in\">cat</span> log.txt | <span class=\"built_in\">tr</span> <span class=\"string\">&#x27;\\r&#x27;</span> <span class=\"string\">&#x27;\\n&#x27;</span> | awk <span class=\"string\">&#x27;&#123;print $NF&#125;&#x27;</span> | sed <span class=\"string\">&#x27;1,3d;$d&#x27;</span> | grep -v <span class=\"string\">&#x27;k\\|M&#x27;</span> &gt;&gt; speed.txt</span><br><span class=\"line\"><span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> `<span class=\"built_in\">cat</span> log.txt | <span class=\"built_in\">tr</span> <span class=\"string\">&#x27;\\r&#x27;</span> <span class=\"string\">&#x27;\\n&#x27;</span> | awk <span class=\"string\">&#x27;&#123;print $NF&#125;&#x27;</span> | sed <span class=\"string\">&#x27;1,3d;$d&#x27;</span> | grep k | sed <span class=\"string\">&#x27;s/k//g&#x27;</span>`</span><br><span class=\"line\"><span class=\"keyword\">do</span></span><br><span class=\"line\">\tk=<span class=\"variable\">$i</span></span><br><span class=\"line\">\tk=$[<span class=\"variable\">$k</span>*1024]</span><br><span class=\"line\">\t<span class=\"built_in\">echo</span> <span class=\"variable\">$k</span> &gt;&gt; speed.txt</span><br><span class=\"line\"><span class=\"keyword\">done</span></span><br><span class=\"line\"><span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> `<span class=\"built_in\">cat</span> log.txt | <span class=\"built_in\">tr</span> <span class=\"string\">&#x27;\\r&#x27;</span> <span class=\"string\">&#x27;\\n&#x27;</span> | awk <span class=\"string\">&#x27;&#123;print $NF&#125;&#x27;</span> | sed <span class=\"string\">&#x27;1,3d;$d&#x27;</span> | grep M | sed <span class=\"string\">&#x27;s/M//g&#x27;</span>`</span><br><span class=\"line\"><span class=\"keyword\">do</span></span><br><span class=\"line\">\ti=$(<span class=\"built_in\">echo</span> | awk <span class=\"string\">&#x27;&#123;print &#x27;</span><span class=\"variable\">$i</span><span class=\"string\">&#x27;*10 &#125;&#x27;</span>)</span><br><span class=\"line\">\tM=<span class=\"variable\">$i</span></span><br><span class=\"line\">\tM=$[<span class=\"variable\">$M</span>*1024*1024/10]</span><br><span class=\"line\">\t<span class=\"built_in\">echo</span> <span class=\"variable\">$M</span> &gt;&gt; speed.txt</span><br><span class=\"line\"><span class=\"keyword\">done</span></span><br><span class=\"line\">max=0</span><br><span class=\"line\"><span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> `<span class=\"built_in\">cat</span> speed.txt`</span><br><span class=\"line\"><span class=\"keyword\">do</span></span><br><span class=\"line\">\t<span class=\"keyword\">if</span> [ <span class=\"variable\">$i</span> -ge <span class=\"variable\">$max</span> ]</span><br><span class=\"line\">\t<span class=\"keyword\">then</span></span><br><span class=\"line\">\t\tmax=<span class=\"variable\">$i</span></span><br><span class=\"line\">\t<span class=\"keyword\">fi</span></span><br><span class=\"line\"><span class=\"keyword\">done</span></span><br><span class=\"line\"><span class=\"built_in\">rm</span> -rf log.txt speed.txt</span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"variable\">$max</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"function\"><span class=\"title\">speedtesthttp</span></span>()&#123;</span><br><span class=\"line\"><span class=\"built_in\">rm</span> -rf log.txt speed.txt</span><br><span class=\"line\"><span class=\"keyword\">if</span> [ $(<span class=\"built_in\">echo</span> <span class=\"variable\">$1</span> | grep : | <span class=\"built_in\">wc</span> -l) == 0 ]</span><br><span class=\"line\"><span class=\"keyword\">then</span></span><br><span class=\"line\">\tcurl -x <span class=\"variable\">$1</span>:80 http://<span class=\"variable\">$domain</span>/<span class=\"variable\">$file</span> -o /dev/null --connect-timeout 1 --max-time 10 &gt; log.txt 2&gt;&amp;1</span><br><span class=\"line\"><span class=\"keyword\">else</span></span><br><span class=\"line\">\tcurl -x [<span class=\"variable\">$1</span>]:80 http://<span class=\"variable\">$domain</span>/<span class=\"variable\">$file</span> -o /dev/null --connect-timeout 1 --max-time 10 &gt; log.txt 2&gt;&amp;1</span><br><span class=\"line\"><span class=\"keyword\">fi</span></span><br><span class=\"line\"><span class=\"built_in\">cat</span> log.txt | <span class=\"built_in\">tr</span> <span class=\"string\">&#x27;\\r&#x27;</span> <span class=\"string\">&#x27;\\n&#x27;</span> | awk <span class=\"string\">&#x27;&#123;print $NF&#125;&#x27;</span> | sed <span class=\"string\">&#x27;1,3d;$d&#x27;</span> | grep -v <span class=\"string\">&#x27;k\\|M&#x27;</span> &gt;&gt; speed.txt</span><br><span class=\"line\"><span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> `<span class=\"built_in\">cat</span> log.txt | <span class=\"built_in\">tr</span> <span class=\"string\">&#x27;\\r&#x27;</span> <span class=\"string\">&#x27;\\n&#x27;</span> | awk <span class=\"string\">&#x27;&#123;print $NF&#125;&#x27;</span> | sed <span class=\"string\">&#x27;1,3d;$d&#x27;</span> | grep k | sed <span class=\"string\">&#x27;s/k//g&#x27;</span>`</span><br><span class=\"line\"><span class=\"keyword\">do</span></span><br><span class=\"line\">\tk=<span class=\"variable\">$i</span></span><br><span class=\"line\">\tk=$[<span class=\"variable\">$k</span>*1024]</span><br><span class=\"line\">\t<span class=\"built_in\">echo</span> <span class=\"variable\">$k</span> &gt;&gt; speed.txt</span><br><span class=\"line\"><span class=\"keyword\">done</span></span><br><span class=\"line\"><span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> `<span class=\"built_in\">cat</span> log.txt | <span class=\"built_in\">tr</span> <span class=\"string\">&#x27;\\r&#x27;</span> <span class=\"string\">&#x27;\\n&#x27;</span> | awk <span class=\"string\">&#x27;&#123;print $NF&#125;&#x27;</span> | sed <span class=\"string\">&#x27;1,3d;$d&#x27;</span> | grep M | sed <span class=\"string\">&#x27;s/M//g&#x27;</span>`</span><br><span class=\"line\"><span class=\"keyword\">do</span></span><br><span class=\"line\">\ti=$(<span class=\"built_in\">echo</span> | awk <span class=\"string\">&#x27;&#123;print &#x27;</span><span class=\"variable\">$i</span><span class=\"string\">&#x27;*10 &#125;&#x27;</span>)</span><br><span class=\"line\">\tM=<span class=\"variable\">$i</span></span><br><span class=\"line\">\tM=$[<span class=\"variable\">$M</span>*1024*1024/10]</span><br><span class=\"line\">\t<span class=\"built_in\">echo</span> <span class=\"variable\">$M</span> &gt;&gt; speed.txt</span><br><span class=\"line\"><span class=\"keyword\">done</span></span><br><span class=\"line\">max=0</span><br><span class=\"line\"><span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> `<span class=\"built_in\">cat</span> speed.txt`</span><br><span class=\"line\"><span class=\"keyword\">do</span></span><br><span class=\"line\">\t<span class=\"keyword\">if</span> [ <span class=\"variable\">$i</span> -ge <span class=\"variable\">$max</span> ]</span><br><span class=\"line\">\t<span class=\"keyword\">then</span></span><br><span class=\"line\">\t\tmax=<span class=\"variable\">$i</span></span><br><span class=\"line\">\t<span class=\"keyword\">fi</span></span><br><span class=\"line\"><span class=\"keyword\">done</span></span><br><span class=\"line\"><span class=\"built_in\">rm</span> -rf log.txt speed.txt</span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"variable\">$max</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"function\"><span class=\"title\">cloudflaretest</span></span>()&#123;</span><br><span class=\"line\"><span class=\"keyword\">while</span> <span class=\"literal\">true</span></span><br><span class=\"line\"><span class=\"keyword\">do</span></span><br><span class=\"line\">\t<span class=\"keyword\">while</span> <span class=\"literal\">true</span></span><br><span class=\"line\">\t<span class=\"keyword\">do</span></span><br><span class=\"line\">\t\t<span class=\"built_in\">rm</span> -rf rtt rtt.txt log.txt speed.txt</span><br><span class=\"line\">\t\t<span class=\"built_in\">mkdir</span> rtt</span><br><span class=\"line\">\t\t<span class=\"built_in\">echo</span> <span class=\"string\">&quot;正在生成 <span class=\"variable\">$ips</span>&quot;</span></span><br><span class=\"line\">\t\t<span class=\"built_in\">unset</span> temp</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> [ <span class=\"string\">&quot;<span class=\"variable\">$ips</span>&quot;</span> == <span class=\"string\">&quot;ipv4&quot;</span> ]</span><br><span class=\"line\">\t\t<span class=\"keyword\">then</span></span><br><span class=\"line\">\t\t\tn=0</span><br><span class=\"line\">\t\t\tiplist=100</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">while</span> <span class=\"literal\">true</span></span><br><span class=\"line\">\t\t\t<span class=\"keyword\">do</span></span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> `awk <span class=\"string\">&#x27;BEGIN&#123;srand()&#125; &#123;print rand()&quot;\\t&quot;$0&#125;&#x27;</span> <span class=\"variable\">$filename</span> | <span class=\"built_in\">sort</span> -n | awk <span class=\"string\">&#x27;&#123;print $2&#125; NR==&#x27;</span><span class=\"variable\">$iplist</span><span class=\"string\">&#x27; &#123;exit&#125;&#x27;</span> | awk -F\\. <span class=\"string\">&#x27;&#123;print $1&quot;.&quot;$2&quot;.&quot;$3&#125;&#x27;</span>`</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">do</span></span><br><span class=\"line\">\t\t\t\t\ttemp[<span class=\"variable\">$n</span>]=$(<span class=\"built_in\">echo</span> <span class=\"variable\">$i</span>.$((<span class=\"variable\">$RANDOM</span>%<span class=\"number\">256</span>)))</span><br><span class=\"line\">\t\t\t\t\tn=$[<span class=\"variable\">$n</span>+1]</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">done</span></span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">if</span> [ <span class=\"variable\">$n</span> -ge <span class=\"variable\">$iplist</span> ]</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">then</span></span><br><span class=\"line\">\t\t\t\t\t<span class=\"built_in\">break</span></span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">fi</span></span><br><span class=\"line\">\t\t\t<span class=\"keyword\">done</span></span><br><span class=\"line\">\t\t\t<span class=\"keyword\">while</span> <span class=\"literal\">true</span></span><br><span class=\"line\">\t\t\t<span class=\"keyword\">do</span></span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">if</span> [ $(<span class=\"built_in\">echo</span> <span class=\"variable\">$&#123;temp[@]&#125;</span> | sed -e <span class=\"string\">&#x27;s/ /\\n/g&#x27;</span> | <span class=\"built_in\">sort</span> -u | <span class=\"built_in\">wc</span> -l) -ge <span class=\"variable\">$iplist</span> ]</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">then</span></span><br><span class=\"line\">\t\t\t\t\t<span class=\"built_in\">break</span></span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">else</span></span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> `awk <span class=\"string\">&#x27;BEGIN&#123;srand()&#125; &#123;print rand()&quot;\\t&quot;$0&#125;&#x27;</span> <span class=\"variable\">$filename</span> | <span class=\"built_in\">sort</span> -n | awk <span class=\"string\">&#x27;&#123;print $2&#125; NR==&#x27;</span>$[<span class=\"variable\">$iplist</span>-$(<span class=\"built_in\">echo</span> <span class=\"variable\">$&#123;temp[@]&#125;</span> | sed -e <span class=\"string\">&#x27;s/ /\\n/g&#x27;</span> | <span class=\"built_in\">sort</span> -u | <span class=\"built_in\">wc</span> -l)]<span class=\"string\">&#x27; &#123;exit&#125;&#x27;</span> | awk -F\\. <span class=\"string\">&#x27;&#123;print $1&quot;.&quot;$2&quot;.&quot;$3&#125;&#x27;</span>`</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">do</span></span><br><span class=\"line\">\t\t\t\t\t\ttemp[<span class=\"variable\">$n</span>]=$(<span class=\"built_in\">echo</span> <span class=\"variable\">$i</span>.$((<span class=\"variable\">$RANDOM</span>%<span class=\"number\">256</span>)))</span><br><span class=\"line\">\t\t\t\t\t\tn=$[<span class=\"variable\">$n</span>+1]</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">done</span></span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">fi</span></span><br><span class=\"line\">\t\t\t<span class=\"keyword\">done</span></span><br><span class=\"line\">\t\t<span class=\"keyword\">else</span></span><br><span class=\"line\">\t\t\tn=0</span><br><span class=\"line\">\t\t\tiplist=100</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">while</span> <span class=\"literal\">true</span></span><br><span class=\"line\">\t\t\t<span class=\"keyword\">do</span></span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> `awk <span class=\"string\">&#x27;BEGIN&#123;srand()&#125; &#123;print rand()&quot;\\t&quot;$0&#125;&#x27;</span> <span class=\"variable\">$filename</span> | <span class=\"built_in\">sort</span> -n | awk <span class=\"string\">&#x27;&#123;print $2&#125; NR==&#x27;</span><span class=\"variable\">$iplist</span><span class=\"string\">&#x27; &#123;exit&#125;&#x27;</span> | awk -F: <span class=\"string\">&#x27;&#123;print $1&quot;:&quot;$2&quot;:&quot;$3&#125;&#x27;</span>`</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">do</span></span><br><span class=\"line\">\t\t\t\t\ttemp[<span class=\"variable\">$n</span>]=$(<span class=\"built_in\">echo</span> <span class=\"variable\">$i</span>:$(<span class=\"built_in\">printf</span> <span class=\"string\">&#x27;%x\\n&#x27;</span> $((<span class=\"variable\">$RANDOM</span>*<span class=\"number\">2</span>+<span class=\"variable\">$RANDOM</span>%<span class=\"number\">2</span>))):$(<span class=\"built_in\">printf</span> <span class=\"string\">&#x27;%x\\n&#x27;</span> $((<span class=\"variable\">$RANDOM</span>*<span class=\"number\">2</span>+<span class=\"variable\">$RANDOM</span>%<span class=\"number\">2</span>))):$(<span class=\"built_in\">printf</span> <span class=\"string\">&#x27;%x\\n&#x27;</span> $((<span class=\"variable\">$RANDOM</span>*<span class=\"number\">2</span>+<span class=\"variable\">$RANDOM</span>%<span class=\"number\">2</span>))):$(<span class=\"built_in\">printf</span> <span class=\"string\">&#x27;%x\\n&#x27;</span> $((<span class=\"variable\">$RANDOM</span>*<span class=\"number\">2</span>+<span class=\"variable\">$RANDOM</span>%<span class=\"number\">2</span>))):$(<span class=\"built_in\">printf</span> <span class=\"string\">&#x27;%x\\n&#x27;</span> $((<span class=\"variable\">$RANDOM</span>*<span class=\"number\">2</span>+<span class=\"variable\">$RANDOM</span>%<span class=\"number\">2</span>))))</span><br><span class=\"line\">\t\t\t\t\tn=$[<span class=\"variable\">$n</span>+1]</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">done</span></span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">if</span> [ <span class=\"variable\">$n</span> -ge <span class=\"variable\">$iplist</span> ]</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">then</span></span><br><span class=\"line\">\t\t\t\t\t<span class=\"built_in\">break</span></span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">fi</span></span><br><span class=\"line\">\t\t\t<span class=\"keyword\">done</span></span><br><span class=\"line\">\t\t\t<span class=\"keyword\">while</span> <span class=\"literal\">true</span></span><br><span class=\"line\">\t\t\t<span class=\"keyword\">do</span></span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">if</span> [ $(<span class=\"built_in\">echo</span> <span class=\"variable\">$&#123;temp[@]&#125;</span> | sed -e <span class=\"string\">&#x27;s/ /\\n/g&#x27;</span> | <span class=\"built_in\">sort</span> -u | <span class=\"built_in\">wc</span> -l) -ge <span class=\"variable\">$iplist</span> ]</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">then</span></span><br><span class=\"line\">\t\t\t\t\t<span class=\"built_in\">break</span></span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">else</span></span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> `awk <span class=\"string\">&#x27;BEGIN&#123;srand()&#125; &#123;print rand()&quot;\\t&quot;$0&#125;&#x27;</span> <span class=\"variable\">$filename</span> | <span class=\"built_in\">sort</span> -n | awk <span class=\"string\">&#x27;&#123;print $2&#125; NR==&#x27;</span>$[<span class=\"variable\">$iplist</span>-$(<span class=\"built_in\">echo</span> <span class=\"variable\">$&#123;temp[@]&#125;</span> | sed -e <span class=\"string\">&#x27;s/ /\\n/g&#x27;</span> | <span class=\"built_in\">sort</span> -u | <span class=\"built_in\">wc</span> -l)]<span class=\"string\">&#x27; &#123;exit&#125;&#x27;</span> | awk -F: <span class=\"string\">&#x27;&#123;print $1&quot;:&quot;$2&quot;:&quot;$3&#125;&#x27;</span>`</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">do</span></span><br><span class=\"line\">\t\t\t\t\t\ttemp[<span class=\"variable\">$n</span>]=$(<span class=\"built_in\">echo</span> <span class=\"variable\">$i</span>:$(<span class=\"built_in\">printf</span> <span class=\"string\">&#x27;%x\\n&#x27;</span> $((<span class=\"variable\">$RANDOM</span>*<span class=\"number\">2</span>+<span class=\"variable\">$RANDOM</span>%<span class=\"number\">2</span>))):$(<span class=\"built_in\">printf</span> <span class=\"string\">&#x27;%x\\n&#x27;</span> $((<span class=\"variable\">$RANDOM</span>*<span class=\"number\">2</span>+<span class=\"variable\">$RANDOM</span>%<span class=\"number\">2</span>))):$(<span class=\"built_in\">printf</span> <span class=\"string\">&#x27;%x\\n&#x27;</span> $((<span class=\"variable\">$RANDOM</span>*<span class=\"number\">2</span>+<span class=\"variable\">$RANDOM</span>%<span class=\"number\">2</span>))):$(<span class=\"built_in\">printf</span> <span class=\"string\">&#x27;%x\\n&#x27;</span> $((<span class=\"variable\">$RANDOM</span>*<span class=\"number\">2</span>+<span class=\"variable\">$RANDOM</span>%<span class=\"number\">2</span>))):$(<span class=\"built_in\">printf</span> <span class=\"string\">&#x27;%x\\n&#x27;</span> $((<span class=\"variable\">$RANDOM</span>*<span class=\"number\">2</span>+<span class=\"variable\">$RANDOM</span>%<span class=\"number\">2</span>))))</span><br><span class=\"line\">\t\t\t\t\t\tn=$[<span class=\"variable\">$n</span>+1]</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">done</span></span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">fi</span></span><br><span class=\"line\">\t\t\t<span class=\"keyword\">done</span></span><br><span class=\"line\">\t\t<span class=\"keyword\">fi</span></span><br><span class=\"line\">\t\tipnum=$(<span class=\"built_in\">echo</span> <span class=\"variable\">$&#123;temp[@]&#125;</span> | sed -e <span class=\"string\">&#x27;s/ /\\n/g&#x27;</span> | <span class=\"built_in\">sort</span> -u | <span class=\"built_in\">wc</span> -l)</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> [ <span class=\"variable\">$tasknum</span> == 0 ]</span><br><span class=\"line\">\t\t<span class=\"keyword\">then</span></span><br><span class=\"line\">\t\t\ttasknum=1</span><br><span class=\"line\">\t\t<span class=\"keyword\">fi</span></span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> [ <span class=\"variable\">$ipnum</span> -lt <span class=\"variable\">$tasknum</span> ]</span><br><span class=\"line\">\t\t<span class=\"keyword\">then</span></span><br><span class=\"line\">\t\t\ttasknum=<span class=\"variable\">$ipnum</span></span><br><span class=\"line\">\t\t<span class=\"keyword\">fi</span></span><br><span class=\"line\">\t\tn=1</span><br><span class=\"line\">\t\t<span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> `<span class=\"built_in\">echo</span> <span class=\"variable\">$&#123;temp[@]&#125;</span> | sed -e <span class=\"string\">&#x27;s/ /\\n/g&#x27;</span> | <span class=\"built_in\">sort</span> -u`</span><br><span class=\"line\">\t\t<span class=\"keyword\">do</span></span><br><span class=\"line\">\t\t\t<span class=\"built_in\">echo</span> <span class=\"variable\">$i</span>&gt;&gt;rtt/<span class=\"variable\">$n</span>.txt</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">if</span> [ <span class=\"variable\">$n</span> == <span class=\"variable\">$tasknum</span> ]</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">then</span></span><br><span class=\"line\">\t\t\t\tn=1</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">else</span></span><br><span class=\"line\">\t\t\t\tn=$[<span class=\"variable\">$n</span>+1]</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">fi</span></span><br><span class=\"line\">\t\t<span class=\"keyword\">done</span></span><br><span class=\"line\">\t\tn=1</span><br><span class=\"line\">\t\t<span class=\"keyword\">while</span> <span class=\"literal\">true</span></span><br><span class=\"line\">\t\t<span class=\"keyword\">do</span></span><br><span class=\"line\">\t\t\t<span class=\"keyword\">if</span> [ <span class=\"variable\">$tls</span> == 1 ]</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">then</span></span><br><span class=\"line\">\t\t\t\trtthttps <span class=\"variable\">$n</span> &amp;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">else</span></span><br><span class=\"line\">\t\t\t\trtthttp <span class=\"variable\">$n</span> &amp;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">fi</span></span><br><span class=\"line\">\t\t\t<span class=\"keyword\">if</span> [ <span class=\"variable\">$n</span> == <span class=\"variable\">$tasknum</span> ]</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">then</span></span><br><span class=\"line\">\t\t\t\t<span class=\"built_in\">break</span></span><br><span class=\"line\">\t\t\t<span class=\"keyword\">else</span></span><br><span class=\"line\">\t\t\t\tn=$[<span class=\"variable\">$n</span>+1]</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">fi</span></span><br><span class=\"line\">\t\t<span class=\"keyword\">done</span></span><br><span class=\"line\">\t\t<span class=\"keyword\">while</span> <span class=\"literal\">true</span></span><br><span class=\"line\">\t\t<span class=\"keyword\">do</span></span><br><span class=\"line\">\t\t\tn=$(<span class=\"built_in\">ls</span> rtt | grep txt | <span class=\"built_in\">wc</span> -l)</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">if</span> [ <span class=\"variable\">$n</span> -ne 0 ]</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">then</span></span><br><span class=\"line\">\t\t\t\t<span class=\"built_in\">echo</span> <span class=\"string\">&quot;<span class=\"subst\">$(date +&#x27;%H:%M:%S&#x27;)</span> 等待RTT测试结束,剩余进程数 <span class=\"variable\">$n</span>&quot;</span></span><br><span class=\"line\">\t\t\t<span class=\"keyword\">else</span></span><br><span class=\"line\">\t\t\t\t<span class=\"built_in\">echo</span> <span class=\"string\">&quot;<span class=\"subst\">$(date +&#x27;%H:%M:%S&#x27;)</span> RTT测试完成&quot;</span></span><br><span class=\"line\">\t\t\t\t<span class=\"built_in\">break</span></span><br><span class=\"line\">\t\t\t<span class=\"keyword\">fi</span></span><br><span class=\"line\">\t\t\t<span class=\"built_in\">sleep</span> 1</span><br><span class=\"line\">\t\t<span class=\"keyword\">done</span></span><br><span class=\"line\">\t\tn=$(<span class=\"built_in\">ls</span> rtt | grep <span class=\"built_in\">log</span> | <span class=\"built_in\">wc</span> -l)</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> [ <span class=\"variable\">$n</span> == 0 ]</span><br><span class=\"line\">\t\t<span class=\"keyword\">then</span></span><br><span class=\"line\">\t\t\t<span class=\"built_in\">echo</span> <span class=\"string\">&quot;当前所有IP都存在RTT丢包&quot;</span></span><br><span class=\"line\">\t\t\t<span class=\"built_in\">echo</span> <span class=\"string\">&quot;继续新的RTT测试&quot;</span></span><br><span class=\"line\">\t\t<span class=\"keyword\">else</span></span><br><span class=\"line\">\t\t\t<span class=\"built_in\">cat</span> rtt/*.<span class=\"built_in\">log</span> &gt; rtt.txt</span><br><span class=\"line\">\t\t\tstatus=0</span><br><span class=\"line\">\t\t\t<span class=\"built_in\">echo</span> <span class=\"string\">&quot;待测速的IP地址&quot;</span></span><br><span class=\"line\">\t\t\t<span class=\"built_in\">cat</span> rtt.txt | <span class=\"built_in\">sort</span> | awk <span class=\"string\">&#x27;&#123;print $2&quot; 往返延迟 &quot;$1&quot; 毫秒&quot;&#125;&#x27;</span></span><br><span class=\"line\">\t\t\t<span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> `<span class=\"built_in\">cat</span> rtt.txt | <span class=\"built_in\">sort</span> | awk <span class=\"string\">&#x27;&#123;print $1&quot;_&quot;$2&#125;&#x27;</span>`</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">do</span></span><br><span class=\"line\">\t\t\t\tavgms=$(<span class=\"built_in\">echo</span> <span class=\"variable\">$i</span> | awk -F_ <span class=\"string\">&#x27;&#123;print $1&#125;&#x27;</span>)</span><br><span class=\"line\">\t\t\t\tip=$(<span class=\"built_in\">echo</span> <span class=\"variable\">$i</span> | awk -F_ <span class=\"string\">&#x27;&#123;print $2&#125;&#x27;</span>)</span><br><span class=\"line\">\t\t\t\t<span class=\"built_in\">echo</span> <span class=\"string\">&quot;正在测试 <span class=\"variable\">$ip</span>&quot;</span></span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">if</span> [ <span class=\"variable\">$tls</span> == 1 ]</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">then</span></span><br><span class=\"line\">\t\t\t\t\tmax=$(speedtesthttps <span class=\"variable\">$ip</span>)</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">else</span></span><br><span class=\"line\">\t\t\t\t\tmax=$(speedtesthttp <span class=\"variable\">$ip</span>)</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">fi</span></span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">if</span> [ <span class=\"variable\">$max</span> -ge <span class=\"variable\">$speed</span> ]</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">then</span></span><br><span class=\"line\">\t\t\t\t\tstatus=1</span><br><span class=\"line\">\t\t\t\t\tanycast=<span class=\"variable\">$ip</span></span><br><span class=\"line\">\t\t\t\t\tmax=$[<span class=\"variable\">$max</span>/1024]</span><br><span class=\"line\">\t\t\t\t\t<span class=\"built_in\">echo</span> <span class=\"string\">&quot;<span class=\"variable\">$ip</span> 峰值速度 <span class=\"variable\">$max</span> kB/s&quot;</span></span><br><span class=\"line\">\t\t\t\t\t<span class=\"built_in\">rm</span> -rf rtt rtt.txt</span><br><span class=\"line\">\t\t\t\t\t<span class=\"built_in\">break</span></span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">else</span></span><br><span class=\"line\">\t\t\t\tmax=$[<span class=\"variable\">$max</span>/1024]</span><br><span class=\"line\">\t\t\t\t<span class=\"built_in\">echo</span> <span class=\"string\">&quot;<span class=\"variable\">$ip</span> 峰值速度 <span class=\"variable\">$max</span> kB/s&quot;</span></span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">fi</span></span><br><span class=\"line\">\t\t\t<span class=\"keyword\">done</span></span><br><span class=\"line\">\t\t\t<span class=\"keyword\">if</span> [ <span class=\"variable\">$status</span> == 1 ]</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">then</span></span><br><span class=\"line\">\t\t\t\t<span class=\"built_in\">break</span></span><br><span class=\"line\">\t\t\t<span class=\"keyword\">fi</span></span><br><span class=\"line\">\t\t<span class=\"keyword\">fi</span></span><br><span class=\"line\">\t<span class=\"keyword\">done</span></span><br><span class=\"line\">\t\t<span class=\"built_in\">break</span></span><br><span class=\"line\"><span class=\"keyword\">done</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"function\"><span class=\"title\">singlehttps</span></span>()&#123;</span><br><span class=\"line\"><span class=\"built_in\">read</span> -p <span class=\"string\">&quot;请输入需要测速的IP: &quot;</span> ip</span><br><span class=\"line\"><span class=\"built_in\">read</span> -p <span class=\"string\">&quot;请输入需要测速的端口(默认443): &quot;</span> port</span><br><span class=\"line\"><span class=\"keyword\">if</span> [ -z <span class=\"string\">&quot;<span class=\"variable\">$ip</span>&quot;</span> ]</span><br><span class=\"line\"><span class=\"keyword\">then</span></span><br><span class=\"line\">\t<span class=\"built_in\">echo</span> <span class=\"string\">&quot;未输入IP&quot;</span></span><br><span class=\"line\"><span class=\"keyword\">fi</span></span><br><span class=\"line\"><span class=\"keyword\">if</span> [ -z <span class=\"string\">&quot;<span class=\"variable\">$port</span>&quot;</span> ]</span><br><span class=\"line\"><span class=\"keyword\">then</span></span><br><span class=\"line\">\tport=443</span><br><span class=\"line\"><span class=\"keyword\">fi</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">&quot;正在测速 <span class=\"variable\">$ip</span> 端口 <span class=\"variable\">$port</span>&quot;</span></span><br><span class=\"line\">speed_download=$(curl --resolve <span class=\"variable\">$domain</span>:<span class=\"variable\">$port</span>:<span class=\"variable\">$ip</span> https://<span class=\"variable\">$domain</span>:<span class=\"variable\">$port</span>/<span class=\"variable\">$file</span> -o /dev/null --connect-timeout 5 --max-time 15 -w %&#123;speed_download&#125; | awk -F\\. <span class=\"string\">&#x27;&#123;printf (&quot;%d\\n&quot;,$1/1024)&#125;&#x27;</span>)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"function\"><span class=\"title\">singlehttp</span></span>()&#123;</span><br><span class=\"line\"><span class=\"built_in\">read</span> -p <span class=\"string\">&quot;请输入需要测速的IP: &quot;</span> ip</span><br><span class=\"line\"><span class=\"built_in\">read</span> -p <span class=\"string\">&quot;请输入需要测速的端口(默认80): &quot;</span> port</span><br><span class=\"line\"><span class=\"keyword\">if</span> [ -z <span class=\"string\">&quot;<span class=\"variable\">$ip</span>&quot;</span> ]</span><br><span class=\"line\"><span class=\"keyword\">then</span></span><br><span class=\"line\">\t<span class=\"built_in\">echo</span> <span class=\"string\">&quot;未输入IP&quot;</span></span><br><span class=\"line\"><span class=\"keyword\">fi</span></span><br><span class=\"line\"><span class=\"keyword\">if</span> [ -z <span class=\"string\">&quot;<span class=\"variable\">$port</span>&quot;</span> ]</span><br><span class=\"line\"><span class=\"keyword\">then</span></span><br><span class=\"line\">\tport=80</span><br><span class=\"line\"><span class=\"keyword\">fi</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">&quot;正在测速 <span class=\"variable\">$ip</span> 端口 <span class=\"variable\">$port</span>&quot;</span></span><br><span class=\"line\"><span class=\"keyword\">if</span> [ $(<span class=\"built_in\">echo</span> <span class=\"variable\">$ip</span> | grep : | <span class=\"built_in\">wc</span> -l) == 0 ]</span><br><span class=\"line\"><span class=\"keyword\">then</span></span><br><span class=\"line\">\tspeed_download=$(curl -x <span class=\"variable\">$ip</span>:<span class=\"variable\">$port</span> http://<span class=\"variable\">$domain</span>:<span class=\"variable\">$port</span>/<span class=\"variable\">$file</span> -o /dev/null --connect-timeout 5 --max-time 15 -w %&#123;speed_download&#125; | awk -F\\. <span class=\"string\">&#x27;&#123;printf (&quot;%d\\n&quot;,$1/1024)&#125;&#x27;</span>)</span><br><span class=\"line\"><span class=\"keyword\">else</span></span><br><span class=\"line\">\tspeed_download=$(curl -x [<span class=\"variable\">$ip</span>]:<span class=\"variable\">$port</span> http://<span class=\"variable\">$domain</span>:<span class=\"variable\">$port</span>/<span class=\"variable\">$file</span> -o /dev/null --connect-timeout 5 --max-time 15 -w %&#123;speed_download&#125; | awk -F\\. <span class=\"string\">&#x27;&#123;printf (&quot;%d\\n&quot;,$1/1024)&#125;&#x27;</span>)</span><br><span class=\"line\"><span class=\"keyword\">fi</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"function\"><span class=\"title\">datacheck</span></span>()&#123;</span><br><span class=\"line\">clear</span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">&quot;如果这些下面这些文件下载失败,可以手动访问网址下载保存至同级目录&quot;</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">&quot;https://www.baipiao.eu.org/cloudflare/colo 另存为 colo.txt&quot;</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">&quot;https://www.baipiao.eu.org/cloudflare/url 另存为 url.txt&quot;</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">&quot;https://www.baipiao.eu.org/cloudflare/ips-v4 另存为 ips-v4.txt&quot;</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">&quot;https://www.baipiao.eu.org/cloudflare/ips-v6 另存为 ips-v6.txt&quot;</span></span><br><span class=\"line\"><span class=\"keyword\">while</span> <span class=\"literal\">true</span></span><br><span class=\"line\"><span class=\"keyword\">do</span></span><br><span class=\"line\">\t<span class=\"keyword\">if</span> [ ! -f <span class=\"string\">&quot;colo.txt&quot;</span> ]</span><br><span class=\"line\">\t<span class=\"keyword\">then</span></span><br><span class=\"line\">\t\t<span class=\"built_in\">echo</span> <span class=\"string\">&quot;从服务器下载数据中心信息 colo.txt&quot;</span></span><br><span class=\"line\">\t\tcurl --retry 2 -s https://www.baipiao.eu.org/cloudflare/colo -o colo.txt</span><br><span class=\"line\">\t<span class=\"keyword\">elif</span> [ ! -f <span class=\"string\">&quot;url.txt&quot;</span> ]</span><br><span class=\"line\">\t<span class=\"keyword\">then</span></span><br><span class=\"line\">\t\t<span class=\"built_in\">echo</span> <span class=\"string\">&quot;从服务器下载测速文件地址 url.txt&quot;</span></span><br><span class=\"line\">\t\tcurl --retry 2 -s https://www.baipiao.eu.org/cloudflare/url -o url.txt</span><br><span class=\"line\">\t<span class=\"keyword\">elif</span> [ ! -f <span class=\"string\">&quot;ips-v4.txt&quot;</span> ]</span><br><span class=\"line\">\t<span class=\"keyword\">then</span></span><br><span class=\"line\">\t\t<span class=\"built_in\">echo</span> <span class=\"string\">&quot;从服务器下载IPV4数据 ips-v4.txt&quot;</span></span><br><span class=\"line\">\t\tcurl --retry 2 -s https://www.baipiao.eu.org/cloudflare/ips-v4 -o ips-v4.txt</span><br><span class=\"line\">\t<span class=\"keyword\">elif</span> [ ! -f <span class=\"string\">&quot;ips-v6.txt&quot;</span> ]</span><br><span class=\"line\">\t<span class=\"keyword\">then</span></span><br><span class=\"line\">\t\t<span class=\"built_in\">echo</span> <span class=\"string\">&quot;从服务器下载IPV6数据 ips-v6.txt&quot;</span></span><br><span class=\"line\">\t\tcurl --retry 2 -s https://www.baipiao.eu.org/cloudflare/ips-v6 -o ips-v6.txt</span><br><span class=\"line\">\t<span class=\"keyword\">else</span></span><br><span class=\"line\">\t\t<span class=\"built_in\">break</span></span><br><span class=\"line\">\t<span class=\"keyword\">fi</span></span><br><span class=\"line\"><span class=\"keyword\">done</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\">datacheck</span><br><span class=\"line\">url=$(sed -n <span class=\"string\">&#x27;1p&#x27;</span> url.txt)</span><br><span class=\"line\">domain=$(<span class=\"built_in\">echo</span> <span class=\"variable\">$url</span> | <span class=\"built_in\">cut</span> -f 1 -d<span class=\"string\">&#x27;/&#x27;</span>)</span><br><span class=\"line\">file=$(<span class=\"built_in\">echo</span> <span class=\"variable\">$url</span> | <span class=\"built_in\">cut</span> -f 2- -d<span class=\"string\">&#x27;/&#x27;</span>)</span><br><span class=\"line\">clear</span><br><span class=\"line\"><span class=\"keyword\">while</span> <span class=\"literal\">true</span></span><br><span class=\"line\"><span class=\"keyword\">do</span></span><br><span class=\"line\">\t<span class=\"built_in\">echo</span> <span class=\"string\">&quot;1. IPV4优选(TLS)&quot;</span></span><br><span class=\"line\">\t<span class=\"built_in\">echo</span> <span class=\"string\">&quot;2. IPV4优选&quot;</span></span><br><span class=\"line\">\t<span class=\"built_in\">echo</span> <span class=\"string\">&quot;3. IPV6优选(TLS)&quot;</span></span><br><span class=\"line\">\t<span class=\"built_in\">echo</span> <span class=\"string\">&quot;4. IPV6优选&quot;</span></span><br><span class=\"line\">\t<span class=\"built_in\">echo</span> <span class=\"string\">&quot;5. 单IP测速(TLS)&quot;</span></span><br><span class=\"line\">\t<span class=\"built_in\">echo</span> <span class=\"string\">&quot;6. 单IP测速&quot;</span></span><br><span class=\"line\">\t<span class=\"built_in\">echo</span> <span class=\"string\">&quot;7. 清空缓存&quot;</span></span><br><span class=\"line\">\t<span class=\"built_in\">echo</span> <span class=\"string\">&quot;8. 更新数据&quot;</span></span><br><span class=\"line\">\t<span class=\"built_in\">echo</span> -e <span class=\"string\">&quot;0. 退出\\n&quot;</span></span><br><span class=\"line\">\t<span class=\"built_in\">read</span> -p <span class=\"string\">&quot;请选择菜单(默认0): &quot;</span> menu</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> [ -z <span class=\"string\">&quot;<span class=\"variable\">$menu</span>&quot;</span> ]</span><br><span class=\"line\">\t<span class=\"keyword\">then</span></span><br><span class=\"line\">\t\tmenu=0</span><br><span class=\"line\">\t<span class=\"keyword\">fi</span></span><br><span class=\"line\">\t<span class=\"keyword\">if</span> [ <span class=\"variable\">$menu</span> == 0 ]</span><br><span class=\"line\">\t<span class=\"keyword\">then</span></span><br><span class=\"line\">\t\tclear</span><br><span class=\"line\">\t\t<span class=\"built_in\">echo</span> <span class=\"string\">&quot;退出成功&quot;</span></span><br><span class=\"line\">\t\t<span class=\"built_in\">break</span></span><br><span class=\"line\">\t<span class=\"keyword\">fi</span></span><br><span class=\"line\">\t<span class=\"keyword\">if</span> [ <span class=\"variable\">$menu</span> == 1 ]</span><br><span class=\"line\">\t<span class=\"keyword\">then</span></span><br><span class=\"line\">\t\tips=ipv4</span><br><span class=\"line\">\t\tfilename=ips-v4.txt</span><br><span class=\"line\">\t\ttls=1</span><br><span class=\"line\">\t\tbettercloudflareip</span><br><span class=\"line\">\t\t<span class=\"built_in\">break</span></span><br><span class=\"line\">\t<span class=\"keyword\">fi</span></span><br><span class=\"line\">\t<span class=\"keyword\">if</span> [ <span class=\"variable\">$menu</span> == 2 ]</span><br><span class=\"line\">\t<span class=\"keyword\">then</span></span><br><span class=\"line\">\t\tips=ipv4</span><br><span class=\"line\">\t\tfilename=ips-v4.txt</span><br><span class=\"line\">\t\ttls=0</span><br><span class=\"line\">\t\tbettercloudflareip</span><br><span class=\"line\">\t\t<span class=\"built_in\">break</span></span><br><span class=\"line\">\t<span class=\"keyword\">fi</span></span><br><span class=\"line\">\t<span class=\"keyword\">if</span> [ <span class=\"variable\">$menu</span> == 3 ]</span><br><span class=\"line\">\t<span class=\"keyword\">then</span></span><br><span class=\"line\">\t\tips=ipv6</span><br><span class=\"line\">\t\tfilename=ips-v6.txt</span><br><span class=\"line\">\t\ttls=1</span><br><span class=\"line\">\t\tbettercloudflareip</span><br><span class=\"line\">\t\t<span class=\"built_in\">break</span></span><br><span class=\"line\">\t<span class=\"keyword\">fi</span></span><br><span class=\"line\">\t<span class=\"keyword\">if</span> [ <span class=\"variable\">$menu</span> == 4 ]</span><br><span class=\"line\">\t<span class=\"keyword\">then</span></span><br><span class=\"line\">\t\tips=ipv6</span><br><span class=\"line\">\t\tfilename=ips-v6.txt</span><br><span class=\"line\">\t\ttls=0</span><br><span class=\"line\">\t\tbettercloudflareip</span><br><span class=\"line\">\t\t<span class=\"built_in\">break</span></span><br><span class=\"line\">\t<span class=\"keyword\">fi</span></span><br><span class=\"line\">\t<span class=\"keyword\">if</span> [ <span class=\"variable\">$menu</span> == 5 ]</span><br><span class=\"line\">\t<span class=\"keyword\">then</span></span><br><span class=\"line\">\t\tsinglehttps</span><br><span class=\"line\">\t\tclear</span><br><span class=\"line\">\t\t<span class=\"built_in\">echo</span> <span class=\"string\">&quot;<span class=\"variable\">$ip</span> 平均速度 <span class=\"variable\">$speed_download</span> kB/s&quot;</span></span><br><span class=\"line\">\t<span class=\"keyword\">fi</span></span><br><span class=\"line\">\t<span class=\"keyword\">if</span> [ <span class=\"variable\">$menu</span> == 6 ]</span><br><span class=\"line\">\t<span class=\"keyword\">then</span></span><br><span class=\"line\">\t\tsinglehttp</span><br><span class=\"line\">\t\tclear</span><br><span class=\"line\">\t\t<span class=\"built_in\">echo</span> <span class=\"string\">&quot;<span class=\"variable\">$ip</span> 平均速度 <span class=\"variable\">$speed_download</span> kB/s&quot;</span></span><br><span class=\"line\">\t<span class=\"keyword\">fi</span></span><br><span class=\"line\">\t<span class=\"keyword\">if</span> [ <span class=\"variable\">$menu</span> == 7 ]</span><br><span class=\"line\">\t<span class=\"keyword\">then</span></span><br><span class=\"line\">\t\t<span class=\"built_in\">rm</span> -rf rtt rtt.txt log.txt speed.txt</span><br><span class=\"line\">\t\tclear</span><br><span class=\"line\">\t\t<span class=\"built_in\">echo</span> <span class=\"string\">&quot;缓存已经清空&quot;</span></span><br><span class=\"line\">\t<span class=\"keyword\">fi</span></span><br><span class=\"line\">\t<span class=\"keyword\">if</span> [ <span class=\"variable\">$menu</span> == 8 ]</span><br><span class=\"line\">\t<span class=\"keyword\">then</span></span><br><span class=\"line\">\t\t<span class=\"built_in\">rm</span> -rf colo.txt url.txt ips-v4.txt ips-v6.txt</span><br><span class=\"line\">\t\tdatacheck</span><br><span class=\"line\">\t\tclear</span><br><span class=\"line\">\t<span class=\"keyword\">fi</span></span><br><span class=\"line\"><span class=\"keyword\">done</span></span><br></pre></td></tr></table></figure>\n","prev":{"title":"看央视卫视地方台电视直播","link":"tv"},"next":{"title":"SquareX 浏览器中的一次性浏览器 用完即删-阅后即焚","link":"squarex"},"plink":"http://l-zm.com/ish-ios/","toc":[{"id":"ish-官网-ish.app","title":"iSH 官网 ish.app","index":"1"},{"id":"下载","title":"下载","index":"2"},{"id":"步骤","title":"步骤","index":"3","children":[{"id":"1.-安装依赖","title":"1. 安装依赖","index":"3.1"},{"id":"2.-下载优选代码.sh脚本-(git项目:-better-cloudflare-ip)","title":"2. 下载优选代码.sh脚本 (Git项目: better-cloudflare-ip)","index":"3.2"},{"id":"3.-开始优选","title":"3. 开始优选","index":"3.3"}]},{"id":"最后","title":"最后","index":"4"}],"reading_time":"3036 字约 20 分钟"}