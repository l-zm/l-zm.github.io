{"title":"iOS App苹果企业签分发","date":"2022-04-22T16:00:00.000Z","date_formatted":{"ll":"Apr 23, 2022","L":"04/23/2022","MM-DD":"04-23"},"link":"2022/04/23/iOS App苹果企业签分发","updated":"2022-04-23T09:29:44.722Z","content":"<h1 id=\"ios-app苹果企业签分发\">iOS App苹果企业签分发<a title=\"#ios-app苹果企业签分发\" href=\"#ios-app苹果企业签分发\"></a></h1>\n<h3 id=\"配置\">配置<a title=\"#配置\" href=\"#配置\"></a></h3>\n<ol>\n<li>\n<p>必须有SSL证书（HTTPS）</p>\n<blockquote>\n<p>企业签分发的 plist、icon、ipa 等文件下载链接必须是https协议的，例如：<a href=\"https://html.xn--tiqt5l2rd.com/company_ios/propertylist.plist\">https://html.主域名.com/company_ios/propertylist.plist</a></p>\n</blockquote>\n</li>\n<li>\n<p>配置MIME</p>\n<blockquote>\n<p>如果是Nginx，在 nginx/conf/mime.types 配置文件里面添加如下配置</p>\n</blockquote>\n<p>说明：</p>\n<ul>\n<li>application/octet-stream表示.ipa后缀的文件是下载类型</li>\n<li>text/xml表示.plist后缀的文件是xml类型</li>\n</ul>\n</li>\n</ol>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">application/octet-stream    ipa</span><br><span class=\"line\">text/xml    plist</span><br></pre></td></tr></table></figure>\n<ol start=\"3\">\n<li>苹果端安装协议</li>\n</ol>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">itms-services:<span class=\"comment\">///?action=download-manifest&amp;url=https://html.主域名.com/company_ios/propertylist.plist</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"使用\">使用<a title=\"#使用\" href=\"#使用\"></a></h3>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 能触发这个地址就好</span></span><br><span class=\"line\">window.location = <span class=\"string\">&quot;itms-services:///?action=download-manifest&amp;url=https://html.主域名.com/company_ios/propertylist.plist&quot;</span> </span><br></pre></td></tr></table></figure>\n<h3 id=\"注意\">注意<a title=\"#注意\" href=\"#注意\"></a></h3>\n<ol>\n<li>自己签名的SSL证书是不行的</li>\n<li>plist 文件中有中文会有问题，需要另存为utf-8格式保存即可</li>\n<li>plist 文件下载路径问题，下载路径不要操作三级，否者会报“无法连接到…”、“此时无法下载…”、“证书有问题…”等</li>\n<li>安装协议 itms-services: 后面是三个&quot;/&quot;，当然，我测试了两个，也是可以的</li>\n<li>客户端对 plist 文件是有缓存的，如果安装不成功，可以修改下 plist 文件名称重新试下</li>\n<li>安装过程中图片无法显示问题，这个在plist文件里面已经设置了图片地址，但是就是不显示</li>\n</ol>\n<h3 id=\"plist文件样本：\">plist文件样本：<a title=\"#plist文件样本：\" href=\"#plist文件样本：\"></a></h3>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?xml version=<span class=\"string\">&quot;1.0&quot;</span> encoding=<span class=\"string\">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class=\"line\"><span class=\"meta\">&lt;!DOCTYPE <span class=\"keyword\">plist</span> <span class=\"keyword\">PUBLIC</span> <span class=\"string\">&quot;-//Apple//DTD PLIST 1.0//EN&quot;</span> <span class=\"string\">&quot;http://www.apple.com/DTDs/PropertyList-1.0.dtd&quot;</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">plist</span> <span class=\"attr\">version</span>=<span class=\"string\">&quot;1.0&quot;</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dict</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">key</span>&gt;</span>items<span class=\"tag\">&lt;/<span class=\"name\">key</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">array</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dict</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">key</span>&gt;</span>assets<span class=\"tag\">&lt;/<span class=\"name\">key</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">array</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">dict</span>&gt;</span></span><br><span class=\"line\">                    <span class=\"tag\">&lt;<span class=\"name\">key</span>&gt;</span>kind<span class=\"tag\">&lt;/<span class=\"name\">key</span>&gt;</span></span><br><span class=\"line\">                    <span class=\"tag\">&lt;<span class=\"name\">string</span>&gt;</span>software-package<span class=\"tag\">&lt;/<span class=\"name\">string</span>&gt;</span></span><br><span class=\"line\">                    <span class=\"tag\">&lt;<span class=\"name\">key</span>&gt;</span>url<span class=\"tag\">&lt;/<span class=\"name\">key</span>&gt;</span></span><br><span class=\"line\">                    <span class=\"tag\">&lt;<span class=\"name\">string</span>&gt;</span>https://www.主域名.com/包.ipa<span class=\"tag\">&lt;/<span class=\"name\">string</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;/<span class=\"name\">dict</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">dict</span>&gt;</span></span><br><span class=\"line\">                    <span class=\"tag\">&lt;<span class=\"name\">key</span>&gt;</span>kind<span class=\"tag\">&lt;/<span class=\"name\">key</span>&gt;</span></span><br><span class=\"line\">                    <span class=\"tag\">&lt;<span class=\"name\">string</span>&gt;</span>full-size-image<span class=\"tag\">&lt;/<span class=\"name\">string</span>&gt;</span></span><br><span class=\"line\">                    <span class=\"tag\">&lt;<span class=\"name\">key</span>&gt;</span>needs-shine<span class=\"tag\">&lt;/<span class=\"name\">key</span>&gt;</span></span><br><span class=\"line\">          　　　　　　　　　　<span class=\"tag\">&lt;<span class=\"name\">true</span>/&gt;</span></span><br><span class=\"line\">                    <span class=\"tag\">&lt;<span class=\"name\">key</span>&gt;</span>url<span class=\"tag\">&lt;/<span class=\"name\">key</span>&gt;</span></span><br><span class=\"line\">                    <span class=\"tag\">&lt;<span class=\"name\">string</span>&gt;</span>http://www.主域名.com/icon-512.png<span class=\"tag\">&lt;/<span class=\"name\">string</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;/<span class=\"name\">dict</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">dict</span>&gt;</span></span><br><span class=\"line\">                    <span class=\"tag\">&lt;<span class=\"name\">key</span>&gt;</span>kind<span class=\"tag\">&lt;/<span class=\"name\">key</span>&gt;</span></span><br><span class=\"line\">                    <span class=\"tag\">&lt;<span class=\"name\">string</span>&gt;</span>display-image<span class=\"tag\">&lt;/<span class=\"name\">string</span>&gt;</span></span><br><span class=\"line\">                    <span class=\"tag\">&lt;<span class=\"name\">key</span>&gt;</span>needs-shine<span class=\"tag\">&lt;/<span class=\"name\">key</span>&gt;</span></span><br><span class=\"line\">          　　　　　　　　　　<span class=\"tag\">&lt;<span class=\"name\">true</span>/&gt;</span></span><br><span class=\"line\">                    <span class=\"tag\">&lt;<span class=\"name\">key</span>&gt;</span>url<span class=\"tag\">&lt;/<span class=\"name\">key</span>&gt;</span></span><br><span class=\"line\">                    <span class=\"tag\">&lt;<span class=\"name\">string</span>&gt;</span>http://www.主域名.com/icon-57.png<span class=\"tag\">&lt;/<span class=\"name\">string</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;/<span class=\"name\">dict</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">array</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">key</span>&gt;</span>metadata<span class=\"tag\">&lt;/<span class=\"name\">key</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">dict</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">key</span>&gt;</span>bundle-identifier<span class=\"tag\">&lt;/<span class=\"name\">key</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">string</span>&gt;</span>com.主域名.bundleId<span class=\"tag\">&lt;/<span class=\"name\">string</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">key</span>&gt;</span>bundle-version<span class=\"tag\">&lt;/<span class=\"name\">key</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">string</span>&gt;</span>2.0.0<span class=\"tag\">&lt;/<span class=\"name\">string</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">key</span>&gt;</span>kind<span class=\"tag\">&lt;/<span class=\"name\">key</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">string</span>&gt;</span>software<span class=\"tag\">&lt;/<span class=\"name\">string</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">key</span>&gt;</span>subtitle<span class=\"tag\">&lt;/<span class=\"name\">key</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">string</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">string</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">key</span>&gt;</span>title<span class=\"tag\">&lt;/<span class=\"name\">key</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">string</span>&gt;</span>App名称<span class=\"tag\">&lt;/<span class=\"name\">string</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">dict</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dict</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">array</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dict</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">plist</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"关于跳转设置信任的逻辑\">关于跳转设置信任的逻辑<a title=\"#关于跳转设置信任的逻辑\" href=\"#关于跳转设置信任的逻辑\"></a></h3>\n<ul>\n<li>\n<p>iOS 9 版本之前可以直接： <code>prefs:root=General&amp;path=ManagedConfigurationList </code></p>\n</li>\n<li>\n<p>iOS 10 系统之后不能直接跳转了，但是可以：<code>https://www.主域名.com/企业签文件.mobileprovision </code></p>\n</li>\n<li>\n<p>JS Demo</p>\n</li>\n</ul>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">    <span class=\"keyword\">if</span>(agent.<span class=\"title function_\">indexOf</span>(<span class=\"string\">&quot;like mac os x&quot;</span>) &gt; <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\"> </span><br><span class=\"line\">        <span class=\"keyword\">var</span> ver=agent.<span class=\"title function_\">match</span>(<span class=\"regexp\">/cpu iphone os (.*?) like mac os/</span>);</span><br><span class=\"line\">        ver = ver[<span class=\"number\">1</span>].<span class=\"title function_\">replace</span>(<span class=\"regexp\">/_/g</span>,<span class=\"string\">&quot;.&quot;</span>)</span><br><span class=\"line\">        ver = ver.<span class=\"title function_\">split</span>(<span class=\"string\">&#x27;.&#x27;</span>)[<span class=\"number\">0</span>]</span><br><span class=\"line\"> </span><br><span class=\"line\">        <span class=\"keyword\">var</span> url = <span class=\"string\">&quot;prefs:root=General&amp;path=ManagedConfigurationList&quot;</span>;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (agent.<span class=\"title function_\">indexOf</span>(<span class=\"string\">&#x27;ipad&#x27;</span>) &gt; <span class=\"number\">0</span> || ver &gt; <span class=\"number\">9</span>) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (agent.<span class=\"title function_\">indexOf</span>(<span class=\"string\">&#x27;browser&#x27;</span>) &lt; <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">                <span class=\"comment\">//证书替换</span></span><br><span class=\"line\">                url   = <span class=\"string\">&quot;https://www.主域名.com/embedded.mobileprovision&quot;</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"title function_\">request</span>(url);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n","prev":{"title":"Hello World","link":"2022/04/23/hello-world"},"plink":"http://l-zm.com/2022/04/23/iOS App苹果企业签分发/","toc":[{"id":"ios-app苹果企业签分发","title":"iOS App苹果企业签分发","index":"1","children":[{"id":"配置","title":"配置","index":"1.1"},{"id":"使用","title":"使用","index":"1.2"},{"id":"注意","title":"注意","index":"1.3"},{"id":"plist文件样本：","title":"plist文件样本：","index":"1.4"},{"id":"关于跳转设置信任的逻辑","title":"关于跳转设置信任的逻辑","index":"1.5"}]}],"reading_time":"706 words in 5 min"}