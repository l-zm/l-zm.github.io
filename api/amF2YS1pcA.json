{"title":"IP地址 归属地查询工具","date":"2022-01-23T00:00:00.000Z","date_formatted":{"ll":"2022年1月23日","L":"2022/01/23","MM-DD":"01-23"},"thumbnail":"https://pic.imgdb.cn/item/62d625d4f54cd3f937338ccf.png","link":"java-ip","tags":["IP"],"categories":["IP"],"updated":"2022-01-22T16:00:00.000Z","content":"<h1 id=\"ip数量统计-(统计时间:2022-01)\">IP数量统计 (统计时间:2022-01)<a title=\"#ip数量统计-(统计时间:2022-01)\" href=\"#ip数量统计-(统计时间:2022-01)\"></a></h1>\n<div class=\"φbq\"><div class=\"φbs\"><table><thead>\n<tr>\n<th style=\"text-align:right\">运营商</th>\n<th style=\"text-align:left\">IP 数量</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:right\">中国大陆</td>\n<td style=\"text-align:left\">336,244,699</td>\n</tr>\n<tr>\n<td style=\"text-align:right\">电信</td>\n<td style=\"text-align:left\">137,027,601</td>\n</tr>\n<tr>\n<td style=\"text-align:right\">联通</td>\n<td style=\"text-align:left\">79,009,205</td>\n</tr>\n<tr>\n<td style=\"text-align:right\">移动</td>\n<td style=\"text-align:left\">35366,683</td>\n</tr>\n<tr>\n<td style=\"text-align:right\">铁通</td>\n<td style=\"text-align:left\">24,553,340</td>\n</tr>\n<tr>\n<td style=\"text-align:right\">教育网</td>\n<td style=\"text-align:left\">17,143,530</td>\n</tr>\n<tr>\n<td style=\"text-align:right\">鹏博士</td>\n<td style=\"text-align:left\">8,754,246</td>\n</tr>\n<tr>\n<td style=\"text-align:right\">华数</td>\n<td style=\"text-align:left\">111,888</td>\n</tr>\n<tr>\n<td style=\"text-align:right\">方正网络</td>\n<td style=\"text-align:left\">740480</td>\n</tr>\n<tr>\n<td style=\"text-align:right\">歌华网络</td>\n<td style=\"text-align:left\">862312</td>\n</tr>\n<tr>\n<td style=\"text-align:right\">阿里巴巴</td>\n<td style=\"text-align:left\">3703716</td>\n</tr>\n</tbody>\n</table></div></div><hr>\n<h1 id=\"方案一-ip2region\">方案一 Ip2region<a title=\"#方案一-ip2region\" href=\"#方案一-ip2region\"></a></h1>\n<h2 id=\"ip2region-是什么\">Ip2region 是什么<a title=\"#ip2region-是什么\" href=\"#ip2region-是什么\"></a></h2>\n<p>Github:<code>https://github.com/lionsoul2014/ip2region</code><br>\nip2region v2.0 - 是一个离线IP地址定位库和IP定位数据管理框架，10微秒级别的查询效率，提供了众多主流编程语言的 <code>xdb</code> 数据生成和查询客户端实现。</p>\n<h1 id=\"ip2region-特性\">Ip2region 特性<a title=\"#ip2region-特性\" href=\"#ip2region-特性\"></a></h1>\n<h3 id=\"1、标准化的数据格式\">1、标准化的数据格式<a title=\"#1、标准化的数据格式\" href=\"#1、标准化的数据格式\"></a></h3>\n<p>每个 ip 数据段的 region 信息都固定了格式：<code>国家|区域|省份|城市|ISP</code>，只有中国的数据绝大部分精确到了城市，其他国家部分数据只能定位到国家，后前的选项全部是0。</p>\n<h3 id=\"2、数据去重和压缩\">2、数据去重和压缩<a title=\"#2、数据去重和压缩\" href=\"#2、数据去重和压缩\"></a></h3>\n<p><code>xdb</code> 格式生成程序会自动去重和压缩部分数据，默认的全部 IP 数据，生成的 ip2region.xdb 数据库是 11MiB，随着数据的详细度增加数据库的大小也慢慢增大。</p>\n<h3 id=\"3、极速查询响应\">3、极速查询响应<a title=\"#3、极速查询响应\" href=\"#3、极速查询响应\"></a></h3>\n<p>即使是完全基于 <code>xdb</code> 文件的查询，单次查询响应时间在十微秒级别，可通过如下两种方式开启内存加速查询：</p>\n<ol>\n<li><code>vIndex</code> 索引缓存 ：使用固定的 <code>512KiB</code> 的内存空间缓存 vector index 数据，减少一次 IO 磁盘操作，保持平均查询效率稳定在10-20微秒之间。</li>\n<li><code>xdb</code> 整个文件缓存：将整个 <code>xdb</code> 文件全部加载到内存，内存占用等同于 <code>xdb</code> 文件大小，无磁盘 IO 操作，保持微秒级别的查询效率。</li>\n</ol>\n<h3 id=\"4、ip-数据管理框架\">4、IP 数据管理框架<a title=\"#4、ip-数据管理框架\" href=\"#4、ip-数据管理框架\"></a></h3>\n<p>v2.0 格式的 <code>xdb</code> 支持亿级别的 IP 数据段行数，region 信息也可以完全自定义，例如：你可以在 region 中追加特定业务需求的数据，例如：GPS信息/国际统一地域信息编码/邮编等。也就是你完全可以使用 ip2region 来管理你自己的 IP 定位数据。</p>\n<h3 id=\"下载-ip2region.xdb\">下载 ip2region.xdb<a title=\"#下载-ip2region.xdb\" href=\"#下载-ip2region.xdb\"></a></h3>\n<p><code>https://gitee.com/lionsoul/ip2region/tree/master/data</code></p>\n<h3 id=\"完全基于文件的查询\">完全基于文件的查询<a title=\"#完全基于文件的查询\" href=\"#完全基于文件的查询\"></a></h3>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.l-zm;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> org.lionsoul.ip2region.xdb.Searcher;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.io.IOException;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.concurrent.TimeUnit;</span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"keyword\">static</span> com.niceloo.framework.web.validation.ValidatorUtils.C.ip;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">SearcherTest</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">main</span><span class=\"params\">(String[] args)</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 1、创建 searcher 对象</span></span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">dbPath</span> <span class=\"operator\">=</span> <span class=\"string\">&quot;C:\\\\ip2region.xdb&quot;</span>;</span><br><span class=\"line\">        <span class=\"type\">Searcher</span> <span class=\"variable\">searcher</span> <span class=\"operator\">=</span> <span class=\"literal\">null</span>;</span><br><span class=\"line\">        <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">            searcher = Searcher.newWithFileOnly(dbPath);</span><br><span class=\"line\">        &#125; <span class=\"keyword\">catch</span> (IOException e) &#123;</span><br><span class=\"line\">            System.out.printf(<span class=\"string\">&quot;failed to create searcher with `%s`: %s\\n&quot;</span>, dbPath, e);</span><br><span class=\"line\">            <span class=\"keyword\">return</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 2、查询</span></span><br><span class=\"line\">        <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">            <span class=\"type\">String</span> <span class=\"variable\">ip</span> <span class=\"operator\">=</span> <span class=\"string\">&quot;39.165.255.51&quot;</span>;</span><br><span class=\"line\">            <span class=\"type\">long</span> <span class=\"variable\">sTime</span> <span class=\"operator\">=</span> System.nanoTime();</span><br><span class=\"line\">            <span class=\"type\">String</span> <span class=\"variable\">region</span> <span class=\"operator\">=</span> searcher.search(ip);</span><br><span class=\"line\">            <span class=\"type\">long</span> <span class=\"variable\">cost</span> <span class=\"operator\">=</span> TimeUnit.NANOSECONDS.toMicros((<span class=\"type\">long</span>) (System.nanoTime() - sTime));</span><br><span class=\"line\">            System.out.printf(<span class=\"string\">&quot;&#123;region: %s, ioCount: %d, took: %d μs&#125;\\n&quot;</span>, region, searcher.getIOCount(), cost);</span><br><span class=\"line\">        &#125; <span class=\"keyword\">catch</span> (Exception e) &#123;</span><br><span class=\"line\">            System.out.printf(<span class=\"string\">&quot;failed to search(%s): %s\\n&quot;</span>, ip, e);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 3、备注：并发使用，每个线程需要创建一个独立的 searcher 对象单独使用。</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>输出:</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;region: 中国|0|河南省|郑州市|移动, ioCount: 5, took: 1025 μs&#125;</span><br></pre></td></tr></table></figure>\n","prev":{"title":"iOS App苹果企业签分发","link":"ios-app-enterprise-sign-share"},"next":{"title":"iPhone与Windows传输文件的几种方式","link":"iPhone-Windows"},"plink":"http://l-zm.com/java-ip/","toc":[{"id":"ip数量统计-(统计时间:2022-01)","title":"IP数量统计 (统计时间:2022-01)","index":"1"},{"id":"方案一-ip2region","title":"方案一 Ip2region","index":"2","children":[{"id":"ip2region-是什么","title":"Ip2region 是什么","index":"2.1"}]},{"id":"ip2region-特性","title":"Ip2region 特性","index":"3","children":[{"id":"1、标准化的数据格式","title":"1、标准化的数据格式","index":"3.1"},{"id":"2、数据去重和压缩","title":"2、数据去重和压缩","index":"3.2"},{"id":"3、极速查询响应","title":"3、极速查询响应","index":"3.3"},{"id":"4、ip-数据管理框架","title":"4、IP 数据管理框架","index":"3.4"},{"id":"下载-ip2region.xdb","title":"下载 ip2region.xdb","index":"3.5"},{"id":"完全基于文件的查询","title":"完全基于文件的查询","index":"3.6"}]}],"reading_time":"772 字约 5 分钟"}